//TP 2021/2022: ZadaÄ‡a 2, Zadatak 1
#include <iostream>
#include <algorithm>
#include <string>
#include <limits>
#include <vector>

int max=std::numeric_limits<int>::max();
int min=std::numeric_limits<int>::min();
long int test_limit;
bool RobotJeAktivan=true;
char dozvoljeniCharovi[]{'A','A','L','D','I','K'};// a je ukljuceno dva puta radi lakseg indexiranja
int pozicije[]{0,1,2,3,4,5,6,7};
std::string strPravci[]{"sjever","sjeveroistok","istok","jugoistok","jug","jugozapad","zapad","sjeverozapad"};
std::string Greske[]{"Nerazumljiva komanda!", "Komanda trazi parametar koji nije naveden!","Zadan je suvisan parametar nakon komande!", "Parametar komande nije ispravan!"};
std::string Aktivnost[]{"neaktivan", "aktivan"};
enum class Smjer {Nalijevo, Nadesno};
enum class Pravci {Sjever, Sjeveroistok, Istok, Jugoistok, Jug, Jugozapad, Zapad, Sjeverozapad};
enum class KodoviGresaka {PogresnaKomanda, NedostajeParametar, SuvisanParametar, NeispravanParametar};
enum class Komande {Aktiviraj, Deaktiviraj, Nalijevo, Nadesno, Idi, Kraj}; 

void AktivirajRobota(){
    RobotJeAktivan=true;
}
void DeaktivirajRobota(){
    RobotJeAktivan=false;
}
void Rotiraj(Pravci &orijentacija, Smjer na_koju_stranu){
    if(RobotJeAktivan)
        std::rotate(pozicije,pozicije+7-6*int(na_koju_stranu),pozicije+8);
        orijentacija=Pravci(pozicije[0]);  
}
void Idi(int &x, int &y, Pravci orijentacija, int korak){
   if(RobotJeAktivan){
        test_limit=x;
    if(orijentacija==Pravci::Sjeveroistok || orijentacija==Pravci::Istok || orijentacija==Pravci::Jugoistok) test_limit+=korak;
    if(orijentacija==Pravci::Sjeverozapad || orijentacija==Pravci::Zapad || orijentacija==Pravci::Jugozapad) test_limit-=korak;
    if(test_limit>max) x= max;
    else if(test_limit<min) x=min;
    else x=test_limit;
    test_limit=y;
    if(orijentacija==Pravci::Sjeveroistok || orijentacija==Pravci::Sjever || orijentacija==Pravci::Sjeverozapad) test_limit+=korak;
    if(orijentacija==Pravci::Jugoistok || orijentacija==Pravci::Jug || orijentacija==Pravci::Jugozapad) test_limit-=korak;
    if(test_limit>max) y= max;
    else if(test_limit<min) y=min;
    else y=test_limit;
   }
}
void IspisiPoziciju(int x, int y, Pravci orijentacija){
        std::cout << "Robot je " << Aktivnost[int(RobotJeAktivan)] << ", nalazi se na poziciji (" << x << "," << y << ") i gleda na " << strPravci[int(orijentacija)] << "." << std::endl;
}
void PrijaviGresku(KodoviGresaka kod_greske){
    std::cout << Greske[int(kod_greske)] << std::endl;
}
void IzvrsiKomandu(Komande komanda, int parametar, int &x, int &y, Pravci &orijentacija){
    if(komanda==Komande::Aktiviraj) AktivirajRobota();
    if(komanda==Komande::Deaktiviraj) DeaktivirajRobota();
    if(komanda==Komande::Nalijevo) Rotiraj(orijentacija, Smjer::Nalijevo);
    if(komanda==Komande::Nadesno) Rotiraj(orijentacija, Smjer::Nadesno);
    if(komanda==Komande::Idi) Idi(x,y,orijentacija,parametar);    
}
bool UnosKomande(Komande &komanda, int &parametar, KodoviGresaka &kod_greske){
    char c,pomocni;
    c=std::cin.get();
    if(c==' '){
        while(std::cin.peek()==' ' ) std::cin.get();
        c=std::cin.get();
    }
    pomocni=std::cin.peek();
    if(!(c=='A' && (pomocni=='-' || pomocni == '+')) && c!='K' && c!='L' && c!='D' && c!='I'){
        kod_greske=KodoviGresaka::PogresnaKomanda;
        std::cin.clear();
        return false;
    }
    if(c=='A') std::cin.get();
    while(std::cin.peek()==' ' ) std::cin.get();
    if(c!='I' && std::cin.peek()!='\n'){
        kod_greske=KodoviGresaka::SuvisanParametar;
        return false;
    } 
    if(c=='I'){
        if(std::cin.peek()=='\n'){
            kod_greske=KodoviGresaka::NedostajeParametar;
            return false;
        }
        while(std::cin.peek()==' ' ) std::cin.get();
        std::cin >> parametar;
        while(std::cin.peek()==' ' ) std::cin.get();
        if(!std::cin || std::cin.peek()!='\n'){
            kod_greske=KodoviGresaka::NeispravanParametar;
            return false;
        }
    }
    komanda=Komande(std::find(dozvoljeniCharovi,dozvoljeniCharovi+6,c)-dozvoljeniCharovi);
    if(pomocni=='-' && c=='A') komanda=Komande::Deaktiviraj;
    return true;
}
int main (){
    int x=0,y=0;
    Pravci orijentacija = Pravci::Sjever;
    bool JeLiKomandaIspravna;
    Komande komanda;
    KodoviGresaka kod_greske;
    IspisiPoziciju(x, y, orijentacija);
    for(;;){
        int parametar;
        std::cout << "Unesi komandu: " << std::endl;
        JeLiKomandaIspravna=UnosKomande(komanda, parametar, kod_greske);
        std::cin.clear();
        std::cin.ignore(10000,'\n');
            if(JeLiKomandaIspravna ){
                if(RobotJeAktivan==true || komanda==Komande::Aktiviraj)
                    IzvrsiKomandu(komanda, parametar, x, y, orijentacija);
                if(komanda!=Komande::Kraj) IspisiPoziciju(x, y, orijentacija);
            }
            else if(RobotJeAktivan== true && JeLiKomandaIspravna==false){
                PrijaviGresku(kod_greske);
                continue;
            }
        if(komanda==Komande::Kraj){
            std::cout << "Dovidjenja!";
            break;
        }
    }
	return 0;
}
